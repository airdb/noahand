version: '3'

tasks:
  default:
    desc: Show help messages
    silent: true
    cmds:
      - echo "Welcome to use go-task!"
      - echo
      - |
        echo "Available tasks:"
        task --list | awk 'NR>1 {print "  " $0}'

  build-plugin:
    desc: Generate plugin
    cmds:
      - CGO_ENABLED=1 go build -buildmode=plugin -o output/01_plugin.so plugins/01_plugin.go
      - CGO_ENABLED=1 go build -buildmode=plugin -o output/02_plugin.so plugins/02_plugin.go
      - CGO_ENABLED=1 go build -buildmode=plugin -o output/03_plugin.so plugins/03_plugin.go

  run:
    desc: Run guardhouse locally
    cmds:
      - go run main.go

  build:
    desc: Build guardhouse binary
    cmds:
      - go build -o main main.go

  docker-build:
    desc: Build guardhouse binary by docker
    cmds:
      - docker compose up --build

  run-plugin:
    desc: Run guardhouse plugin mode
    cmds:
      - go run main.go plugin
  run-plugin:
    desc: Run guardhouse plugin mode
    cmds:
      - go run main.go plugin
