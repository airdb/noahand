# Noah Modules 开发规范


Module (Other deamon Agents) 是 Noah 系统的负责管理的其他系统 agent ，通过 Zeus 插件启动和管理。本文档介绍了 Module 的开发规范和最佳实践。


## 限制规范

资源与权限管理: 限制 CPU、内存使用量，并控制模块包大小，防止系统资源消耗过多。

## 文件规范
- 包大小: 单个 module 包大小建议控制在 100MB 以内。 如果超过则不允许上传。
- 只有可执行文件，才有x权限， 正常是755
- 其他文件应该是只读的，正常是644
- Agent module 单个 tarball 文件的大小应该在 100M 以内。 如果超过则不允许上传。



## Module 开发结构

目录结构:

arduino
Copy code
modules/
├── module_name/
│   ├── main.go
│   ├── config/
│   ├── bin/
│   └── README.md
接口规范: 每个 module 必须实现健康检查、日志输出、状态反馈接口，便于 Zeus 管理。



## 包管理规范

和 deb 包类似， 我们

```tree
.
|-- changelog
|-- control
|-- ROOT
|-- postinst
|-- postrm
|-- preinst
`-- prerm
```

 1. changelog：
 • 用于记录软件包的更改历史。通常包含版本更新内容、修复的错误、新功能等详细信息，方便用户和维护者了解每次更新的具体内容。

 2. control：
 • 是 tarball的核心文件，包含软件包的元信息（metadata），例如包名、版本、描述、依赖关系等。
 • control 文件中的信息对包管理系统至关重要，因为它帮助系统解析包的名称、所需的依赖项以及适合安装的环境。

 3. postinst（Post-Installation Script）：
 • 在软件包安装后执行的脚本，通常用于进行安装后配置或初始化操作。
 • 例如，可以创建必要的文件夹、配置系统服务、设置权限或生成缓存。
 • 如果在安装过程中需要对软件进行进一步配置，postinst 脚本会自动执行。

 4. postrm（Post-Removal Script）：
 • 在软件包卸载后执行的脚本，用于清理残留的文件或目录。
 • 例如，postrm 脚本可以删除不再需要的缓存文件、日志文件等，确保卸载后的系统状态干净无残留。
 • 在软件被完全卸载时，这个脚本才会被执行。

 5. preinst（Pre-Installation Script）：
 • 在安装软件包之前执行的脚本，通常用于准备安装环境。
 • 例如，preinst 脚本可以用来停止正在运行的旧版本服务，备份旧的配置文件等，以确保新版本可以顺利安装。
 • 适合用来进行前置配置或卸载旧版本文件。

 6. prerm（Pre-Removal Script）：
 • 在卸载或升级前执行的脚本，通常用于停止服务或清理工作。
 • 例如，如果一个软件在运行，prerm 脚本可以确保停止相关进程，避免文件占用或冲突。
 • 在删除旧版本时，它会执行一些清理操作，以便为新版本的安装腾出空间或消除冲突。

 7. Root：则是包中的具体位置，noah 会将文件放在对应系统中的位置。

## 下载安装

- Step 1: 下载 `.md5` 文件：获取软件包的 MD5 校验值, 检查 `modules/{md5}/` 路径是否存在。
  - 如果存在，则跳过下载，直接进行安装。
  - 如果不存在，则继续下载软件包。
- Step 2: 下载 `.tar.gz` 文件：下载软件包的压缩包。 比对 MD5 校验值，确保下载的文件完整。
- Step 3: 解压缩：解压缩下载的软件包。
- Step 4: 安装：根据软件包的内容，执行相应的安装操作。
